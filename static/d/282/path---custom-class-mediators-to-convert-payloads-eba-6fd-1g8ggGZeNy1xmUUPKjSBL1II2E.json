{"data":{"site":{"siteMetadata":{"title":"stackcheats"}},"markdownRemark":{"id":"c8bd396e-f3c6-5926-be98-e2161b032d88","excerpt":"Intro Class mediators provide an extended platform to develop user-specific implementations and custom mediation logic in the form of Java classes. In this…","html":"<h2>Intro</h2>\n<p>Class mediators provide an extended platform to develop user-specific implementations and custom mediation logic in the form of Java classes. In this sheet, we will be developing a custom class mediator to read, manipulate and convert (change) a simple payload to meet our requirements.</p>\n<p class=\"quote text-secondary\">\n    Class mediators are designed to use on user-specific custom implementations when there are no other built-in mediators to solve the requirement\n</p>\n<h3>Requirement</h3>\n<p>The requirement is to develop a simple custom class mediator to read and change the value of the <code class=\"language-text\">name</code> attribute of a given payload from “medium” to “Athiththan”.</p>\n<p>The actual payload and the expected converted (changed) payload formats are given below.</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\">-------------------------------------\n// request payload || original\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"post\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"WSO2 Class Mediator: Convert Payload\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"medium\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n-------------------------------------\n// mediated payload || tconverted\n<span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"post\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"WSO2 Class Mediator: Convert Payload\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"dev\"</span> <span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Athiththan\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n-------------------------------------</code></pre></div>\n<h2>Configure</h2>\n<p>To fabricate our custom class mediator or to generate a maven project, we can follow either</p>\n<ul>\n<li>using the given <code class=\"language-text\">pom.xml</code> file to generate a maven project</li>\n<li>using a custom-developed maven-archetype to generate a maven project</li>\n</ul>\n<p>Following sections presents the steps on using given <code class=\"language-text\">pom.xml</code> and using custom developed-archetype to generate maven projects for our custom implementation.</p>\n<h3>pom.xml</h3>\n<p>Create a maven quick-start project and replace the dependencies with the following</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!-- change the packaging to bundle (from jar) to support OSGi --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>packaging</span><span class=\"token punctuation\">></span></span>jar<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>packaging</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependencies</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- apache synapse and related dependencies --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.synapse<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>synapse-core<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>2.1.7-wso2v60<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.axis2.wso2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span>\n        <span class=\"token attr-name\">&lt;artifactId</span><span class=\"token punctuation\">></span></span>axis2<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span>\n        <span class=\"token attr-name\">&lt;version</span><span class=\"token punctuation\">></span></span>1.6.1.wso2v20<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>commons-logging<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>commons-logging<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span>\n        <span class=\"token attr-name\">&lt;version</span><span class=\"token punctuation\">></span></span>1.1.1<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dependency</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>junit<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>version</span><span class=\"token punctuation\">></span></span>4.11<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>scope</span><span class=\"token punctuation\">></span></span>test<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>scope</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependency</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dependencies</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>repositories</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>repository</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span><span class=\"token punctuation\">></span></span>wso2-nexus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>id</span>\n        <span class=\"token attr-name\">&lt;url</span><span class=\"token punctuation\">></span></span>http://maven.wso2.org/nexus/content/groups/wso2-public/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>releases</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>enabled</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>enabled</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>updatePolicy</span><span class=\"token punctuation\">></span></span>daily<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>updatePolicy</span>\n            <span class=\"token attr-name\">&lt;checksumPolicy</span><span class=\"token punctuation\">></span></span>ignore<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>checksumPolicy</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>releases</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>repository</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>repositories</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pluginRepositories</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>pluginRepository</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span><span class=\"token punctuation\">></span></span>wso2-nexus<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>id</span>\n        <span class=\"token attr-name\">&lt;url</span><span class=\"token punctuation\">></span></span>http://maven.wso2.org/nexus/content/groups/wso2-public/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>releases</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>enabled</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>enabled</span>\n            <span class=\"token attr-name\">&lt;updatePolicy</span><span class=\"token punctuation\">></span></span>daily<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>updatePolicy</span>\n            <span class=\"token attr-name\">&lt;checksumPolicy</span><span class=\"token punctuation\">></span></span>ignore<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>checksumPolicy</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>releases</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pluginRepository</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>pluginRepositories</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>build</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugins</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.maven.plugins<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span>\n            <span class=\"token attr-name\">&lt;artifactId</span><span class=\"token punctuation\">></span></span>maven-compiler-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span>\n            <span class=\"token attr-name\">&lt;version</span><span class=\"token punctuation\">></span></span>2.0<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>source</span><span class=\"token punctuation\">></span></span>1.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>source</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>target</span><span class=\"token punctuation\">></span></span>1.8<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>target</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span>\n\n        <span class=\"token comment\">&lt;!-- build plugin for OSGi Bundle support --></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>plugin</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>groupId</span><span class=\"token punctuation\">></span></span>org.apache.felix<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>groupId</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>artifactId</span><span class=\"token punctuation\">></span></span>maven-bundle-plugin<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>artifactId</span>\n            <span class=\"token attr-name\">&lt;version</span><span class=\"token punctuation\">></span></span>2.3.4<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>version</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>extensions</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>extensions</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>instructions</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Bundle-SymbolicName</span><span class=\"token punctuation\">></span></span>\n                        ${groupId}\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Bundle-SymbolicName</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Bundle-Name</span><span class=\"token punctuation\">></span></span>${groupId}<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Bundle-Name</span>\n                    <span class=\"token attr-name\">&lt;Export-Package</span><span class=\"token punctuation\">></span></span>\n                        ${groupId}.*,\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Export-Package</span><span class=\"token punctuation\">></span></span>\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Import-Package</span><span class=\"token punctuation\">></span></span>\n                        *; resolution:=optional\n                    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Import-Package</span><span class=\"token punctuation\">></span></span>\n                <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>instructions</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugin</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>plugins</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>build</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h3>Build using Maven Archetype</h3>\n<p>Clone or download the custom-developed <a href=\"https://github.com/athiththan11/WSO2-Mediators-Maven-Archetype\">maven-archetype</a> and run the following command to build and install the archetype locally on your machine to generate boilerplates for our custom class mediators.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">mvn clean install</code></pre></div>\n<p>Then, execute the following command to generate a Maven project (boilerplate)</p>\n<blockquote>\n<p>Change the command according to your required Group ID and Artifact ID arguments</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">mvn archetype:generate  -DarchetypeGroupId=com.athiththan.wso2     \\\n                        -DarchetypeArtifactId=wso2-mediators       \\\n                        -DarchetypeVersion=1.0.0                   \\\n                        -DgroupId=&lt;Your Group ID&gt;                  \\\n                        -DartifactId=&lt;Your Artifact ID&gt;</code></pre></div>\n<h2>Development</h2>\n<h3>Class Mediator</h3>\n<p>We can develop a custom Class mediator by implementing the <code class=\"language-text\">Mediator</code> class or by extending the <code class=\"language-text\">AbstractMediator</code> class. In this sheet, We will discuss developing a custom class mediator by extending the <code class=\"language-text\">org.apache.synapse.mediators.AbstractMediator</code> class.</p>\n<blockquote>\n<p>The custom mediation logic has to defined inside the <code class=\"language-text\">mediate()</code> method to get execute</p>\n</blockquote>\n<p>A simple class mediator implementation to convert the name attribute from <code class=\"language-text\">medium</code> to <code class=\"language-text\">Athiththan</code> is presented below.</p>\n<p><div id=\"gist96097214\" class=\"gist\">\n    <div class=\"gist-file\">\n      <div class=\"gist-data\">\n        <div class=\"js-gist-file-update-container js-task-list-container file-box\">\n  <div id=\"file-custommediator-java\" class=\"file\">\n    \n\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper data type-java \">\n      \n<table class=\"highlight tab-size js-file-line-container\" data-tab-size=\"8\">\n      <tr>\n        <td id=\"file-custommediator-java-L1\" class=\"blob-num js-line-number\" data-line-number=\"1\"></td>\n        <td id=\"file-custommediator-java-LC1\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">package</span> <span class=\"pl-smi\">&lt;your</span> package namespace<span class=\"pl-k\">&gt;</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L2\" class=\"blob-num js-line-number\" data-line-number=\"2\"></td>\n        <td id=\"file-custommediator-java-LC2\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L3\" class=\"blob-num js-line-number\" data-line-number=\"3\"></td>\n        <td id=\"file-custommediator-java-LC3\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.synapse.MessageContext</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L4\" class=\"blob-num js-line-number\" data-line-number=\"4\"></td>\n        <td id=\"file-custommediator-java-LC4\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.synapse.commons.json.JsonUtil</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L5\" class=\"blob-num js-line-number\" data-line-number=\"5\"></td>\n        <td id=\"file-custommediator-java-LC5\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.synapse.core.axis2.Axis2MessageContext</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L6\" class=\"blob-num js-line-number\" data-line-number=\"6\"></td>\n        <td id=\"file-custommediator-java-LC6\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.apache.synapse.mediators.AbstractMediator</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L7\" class=\"blob-num js-line-number\" data-line-number=\"7\"></td>\n        <td id=\"file-custommediator-java-LC7\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">import</span> <span class=\"pl-smi\">org.json.JSONObject</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L8\" class=\"blob-num js-line-number\" data-line-number=\"8\"></td>\n        <td id=\"file-custommediator-java-LC8\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L9\" class=\"blob-num js-line-number\" data-line-number=\"9\"></td>\n        <td id=\"file-custommediator-java-LC9\" class=\"blob-code blob-code-inner js-file-line\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-en\">CustomMediator</span> <span class=\"pl-k\">extends</span> <span class=\"pl-e\">AbstractMediator</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L10\" class=\"blob-num js-line-number\" data-line-number=\"10\"></td>\n        <td id=\"file-custommediator-java-LC10\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L11\" class=\"blob-num js-line-number\" data-line-number=\"11\"></td>\n        <td id=\"file-custommediator-java-LC11\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">@Override</span></td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L12\" class=\"blob-num js-line-number\" data-line-number=\"12\"></td>\n        <td id=\"file-custommediator-java-LC12\" class=\"blob-code blob-code-inner js-file-line\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">boolean</span> <span class=\"pl-en\">mediate</span>(<span class=\"pl-smi\">MessageContext</span> <span class=\"pl-v\">synCtx</span>) {</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L13\" class=\"blob-num js-line-number\" data-line-number=\"13\"></td>\n        <td id=\"file-custommediator-java-LC13\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L14\" class=\"blob-num js-line-number\" data-line-number=\"14\"></td>\n        <td id=\"file-custommediator-java-LC14\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-smi\">org.apache.axis2.context<span class=\"pl-k\">.</span>MessageContext</span> axis2MessageContext <span class=\"pl-k\">=</span> ((<span class=\"pl-smi\">Axis2MessageContext</span>) synCtx)</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L15\" class=\"blob-num js-line-number\" data-line-number=\"15\"></td>\n        <td id=\"file-custommediator-java-LC15\" class=\"blob-code blob-code-inner js-file-line\">                .getAxis2MessageContext();</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L16\" class=\"blob-num js-line-number\" data-line-number=\"16\"></td>\n        <td id=\"file-custommediator-java-LC16\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L17\" class=\"blob-num js-line-number\" data-line-number=\"17\"></td>\n        <td id=\"file-custommediator-java-LC17\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">try</span> {</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L18\" class=\"blob-num js-line-number\" data-line-number=\"18\"></td>\n        <td id=\"file-custommediator-java-LC18\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-smi\">JSONObject</span> jsonObject <span class=\"pl-k\">=</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">JSONObject</span>(<span class=\"pl-smi\">JsonUtil</span><span class=\"pl-k\">.</span>jsonPayloadToString(axis2MessageContext));</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L19\" class=\"blob-num js-line-number\" data-line-number=\"19\"></td>\n        <td id=\"file-custommediator-java-LC19\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-k\">if</span> (jsonObject<span class=\"pl-k\">.</span>has(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>dev<span class=\"pl-pds\">&quot;</span></span>) <span class=\"pl-k\">&amp;&amp;</span> jsonObject<span class=\"pl-k\">.</span>getJSONObject(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>dev<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>has(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>name<span class=\"pl-pds\">&quot;</span></span>)</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L20\" class=\"blob-num js-line-number\" data-line-number=\"20\"></td>\n        <td id=\"file-custommediator-java-LC20\" class=\"blob-code blob-code-inner js-file-line\">                    <span class=\"pl-k\">&amp;&amp;</span> <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>medium<span class=\"pl-pds\">&quot;</span></span><span class=\"pl-k\">.</span>equals((<span class=\"pl-smi\">String</span>) jsonObject<span class=\"pl-k\">.</span>getJSONObject(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>dev<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>get(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>name<span class=\"pl-pds\">&quot;</span></span>))) {</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L21\" class=\"blob-num js-line-number\" data-line-number=\"21\"></td>\n        <td id=\"file-custommediator-java-LC21\" class=\"blob-code blob-code-inner js-file-line\">                jsonObject<span class=\"pl-k\">.</span>getJSONObject(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>dev<span class=\"pl-pds\">&quot;</span></span>)<span class=\"pl-k\">.</span>put(<span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>name<span class=\"pl-pds\">&quot;</span></span>, <span class=\"pl-s\"><span class=\"pl-pds\">&quot;</span>Athiththan<span class=\"pl-pds\">&quot;</span></span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L22\" class=\"blob-num js-line-number\" data-line-number=\"22\"></td>\n        <td id=\"file-custommediator-java-LC22\" class=\"blob-code blob-code-inner js-file-line\">            }</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L23\" class=\"blob-num js-line-number\" data-line-number=\"23\"></td>\n        <td id=\"file-custommediator-java-LC23\" class=\"blob-code blob-code-inner js-file-line\">            </td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L24\" class=\"blob-num js-line-number\" data-line-number=\"24\"></td>\n        <td id=\"file-custommediator-java-LC24\" class=\"blob-code blob-code-inner js-file-line\">            <span class=\"pl-smi\">JsonUtil</span><span class=\"pl-k\">.</span>newJsonPayload(axis2MessageContext, jsonObject<span class=\"pl-k\">.</span>toString(), <span class=\"pl-c1\">true</span>, <span class=\"pl-c1\">true</span>);</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L25\" class=\"blob-num js-line-number\" data-line-number=\"25\"></td>\n        <td id=\"file-custommediator-java-LC25\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L26\" class=\"blob-num js-line-number\" data-line-number=\"26\"></td>\n        <td id=\"file-custommediator-java-LC26\" class=\"blob-code blob-code-inner js-file-line\">        } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">JSONException</span> e) {</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L27\" class=\"blob-num js-line-number\" data-line-number=\"27\"></td>\n        <td id=\"file-custommediator-java-LC27\" class=\"blob-code blob-code-inner js-file-line\">            e<span class=\"pl-k\">.</span>printStackTrace();</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L28\" class=\"blob-num js-line-number\" data-line-number=\"28\"></td>\n        <td id=\"file-custommediator-java-LC28\" class=\"blob-code blob-code-inner js-file-line\">        }</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L29\" class=\"blob-num js-line-number\" data-line-number=\"29\"></td>\n        <td id=\"file-custommediator-java-LC29\" class=\"blob-code blob-code-inner js-file-line\">\n</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L30\" class=\"blob-num js-line-number\" data-line-number=\"30\"></td>\n        <td id=\"file-custommediator-java-LC30\" class=\"blob-code blob-code-inner js-file-line\">        <span class=\"pl-k\">return</span> <span class=\"pl-c1\">true</span>;</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L31\" class=\"blob-num js-line-number\" data-line-number=\"31\"></td>\n        <td id=\"file-custommediator-java-LC31\" class=\"blob-code blob-code-inner js-file-line\">    }</td>\n      </tr>\n      <tr>\n        <td id=\"file-custommediator-java-L32\" class=\"blob-num js-line-number\" data-line-number=\"32\"></td>\n        <td id=\"file-custommediator-java-LC32\" class=\"blob-code blob-code-inner js-file-line\">}</td>\n      </tr>\n</table>\n\n\n  </div>\n\n  </div>\n</div>\n\n      </div>\n      <div class=\"gist-meta\">\n        <a href=\"https://gist.github.com/athiththan11/71e8c5baa662c34b46a008ea824332a9/raw/54d5ffe949369ad2efe71207927293260d059d09/CustomMediator.java\" style=\"float:right\">view raw</a>\n        <a href=\"https://gist.github.com/athiththan11/71e8c5baa662c34b46a008ea824332a9#file-custommediator-java\">CustomMediator.java</a>\n        hosted with &#10084; by <a href=\"https://github.com\">GitHub</a>\n      </div>\n    </div>\n</div></p>\n<h2>Build, Run &#x26; Test</h2>\n<h3>Build</h3>\n<p>Execute the following command from our project root folder to build and package our custom mediator implementation.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">mvn clean package</code></pre></div>\n<p>As a result, maven will package our implementation as a JAR (Java Archive) artifact, which can be found inside the <code class=\"language-text\">/target</code> folder.</p>\n<h3>Run &#x26; Test</h3>\n<blockquote>\n<p>For demonstration purposes</p>\n</blockquote>\n<p>I will be mocking and using the <code class=\"language-text\">Token_Endpoint</code> of WSO2 API Manager (2.6.0) and will be referring to the installation path of WSO2 API-M as <code class=\"language-text\">&lt;API-M_HOME&gt;</code> and our JAR artifact as <code class=\"language-text\">CM-IMPL-JAR</code>.</p>\n<ul>\n<li>Copy the <code class=\"language-text\">CM-IMPL_JAR</code> from the <code class=\"language-text\">/target</code> folder and paste it inside the <code class=\"language-text\">&lt;API-M_HOME&gt;/repository/components/lib/</code> directory</li>\n<li>Navigate to <code class=\"language-text\">&lt;API-M_HOME&gt;/repository/deployment/server/synapse-configs/default/api/</code> and open and edit the inSequence tag of the <code class=\"language-text\">_TokenAPI_.xml</code> file as follows</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>inSequence</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token comment\">&lt;!-- &lt;property name=\"uri.var.portnum\" expression=\"get-property('keyManager.port')\"/>\n    &lt;property name=\"uri.var.hostname\" expression=\"get-property('keyManager.hostname')\"/>\n    &lt;send>\n        &lt;endpoint>\n            &lt;http uri-template=\"https://{uri.var.hostname}:{uri.var.portnum}/oauth2/token\">\n                &lt;timeout>\n                    &lt;duration>60000&lt;/duration\n                    &lt;responseAction>fault&lt;/responseAction>\n                &lt;/timeout>\n            &lt;/http>\n        &lt;/endpoint>\n    &lt;/send> --></span>\n    <span class=\"token comment\">&lt;!-- convert dev.name to athiththan --></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>class</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>&lt;YOUR PACKAGE NAME>.&lt;CLASS NAME><span class=\"token punctuation\">\"</span></span> <span class=\"token punctuation\">/></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>respond</span> <span class=\"token punctuation\">/></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>inSequence</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<blockquote>\n<p>Replace <code class=\"language-text\">&lt;YOUR PACKAGE NAME&gt;.&lt;CLASS NAME&gt;</code> with the actual package name and your Java class name.</p>\n</blockquote>\n<p>For example …</p>\n<p>If you have implemented your class mediator implementation in a Java class named <code class=\"language-text\">CustomClassMediator</code> inside the <code class=\"language-text\">com.sample.demos package</code>, then it comes as <code class=\"language-text\">com.sample.demos.CustomClassMediator</code> resulting <code class=\"language-text\">&lt;class name=&quot;com.sample.demos.CustomClassMediator&quot; /&gt;</code>.</p>\n<p>After pasting our <code class=\"language-text\">CM-IMPL_JAR</code> and editing the <code class=\"language-text\">_TokenAPI_.xml</code> file, start the WSO2 API Manager instance using the following command.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">sh wso2server.sh</code></pre></div>\n<p>Use the following cURL command to execute the Token Endpoint of the WSO2 API Manager instance by replacing the <code class=\"language-text\">&lt;Your Host&gt;</code> tag with respective host value</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">curl -k --request POST \\\n    -d &#39;{&quot;post&quot;:&quot;WSO2 Class Mediator: Convert Payload&quot;,&quot;dev&quot;:{&quot;name&quot;:&quot;medium&quot;}}&#39; \\\n    -H &quot;Content-Type: application/json&quot; \\\n    https://&lt;YOUR HOST&gt;:8243/token</code></pre></div>\n<p>After successful execution, we can observe the response as follows</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"post\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"WSO2 Class Mediator: Convert Payload\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"dev\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"Athiththan\"</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>GitHub</h2>\n<a href=\"https://github.com/athiththan11/Revamp-Mediator\">\n    <div class=\"card\">\n        <div class=\"card-horizontal\">\n            <div class=\"card-body py-0 px-5\">\n                <h4 class=\"card-title\">Revamp Mediator</h4>\n                <p>A custom mediation logic to convert payload attribute values using WSO2 Class Mediator extension</p>\n            </div>\n            <div class=\"img-square-wrapper\">\n                <img class=\"rounded mb-0\" src=\"https://avatars3.githubusercontent.com/u/29927177?s=460&amp;v=4\" alt>\n            </div>\n        </div>\n    </div>\n</a>\n<hr class=\"three--dots\"/>","frontmatter":{"title":"Custom Class Mediators to Convert Payloads","intro":"WSO2 Class Mediators: Change Values of a Payload Attribute","tags":["wso2","class-mediators"]}}},"pageContext":{"slug":"/Custom-Class-Mediators-to-Convert-Payloads/","node_id":"c8bd396e-f3c6-5926-be98-e2161b032d88","nodePath":"/Custom-Class-Mediators-to-Convert-Payloads/","nodeType":"sheet","title":"Custom Class Mediators to Convert Payloads","category":"WSO2","weight":-1,"updated":"2019-07-17T00:00:00.000Z","author":"Athiththan","short":"A Custom Class Mediator Implementation","tags":["wso2","class-mediators"]}}