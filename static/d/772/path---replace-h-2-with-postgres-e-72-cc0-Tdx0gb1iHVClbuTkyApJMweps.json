{"data":{"site":{"siteMetadata":{"title":"stackcheats"}},"markdownRemark":{"id":"eac2d4d3-f6b0-5791-beef-f546659f719f","excerpt":"Docker: Postgres Pull Prerequisites: Docker installed in your environment. You can follow the  Docker  docs to get it done. Follow the given steps to set up…","html":"<h2>Docker: Postgres</h2>\n<h3>Pull</h3>\n<blockquote>\n<p>Prerequisites: Docker installed in your environment. You can follow the <a href=\"https://www.docker.com/get-started\">Docker</a> docs to get it done.</p>\n</blockquote>\n<p>Follow the given steps to set up Postgres using Docker in your dev environments. For this demo, we will be using <strong>Postgres - 9.6.14</strong> and <strong>WSO2 Identity Server 5.7</strong>.</p>\n<p>Start the Docker service and execute the following command to pull the Postgres (9.6.14) image from <a href=\"https://hub.docker.com/_/postgres\">DockerHub</a></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker pull postgres:9.6.14</code></pre></div>\n<h3>Run</h3>\n<p>After a successful pull, execute the below command to create and run a docker container for our pulled Postgres image. Replace the <code class=\"language-text\">&lt;CONTAINER_NAME&gt;</code> tag with your preferred name or use <code class=\"language-text\">postgres-9.6.14</code> as the default value.</p>\n<blockquote>\n<p>You can change the Postgres password by changing the <code class=\"language-text\">POSTGRES_PASSWORD</code> value from <code class=\"language-text\">hydrogen</code> to any preferred secured password</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker run --name &lt;CONTAINER_NAME || postgres-9.6.14&gt; -e POSTGRES_PASSWORD=hydrogen -p 5432:5432 -d -v $HOME/docker/volumes/postgres:/var/lib/postgresql postgres:9.6.14</code></pre></div>\n<blockquote>\n<p>Basic commands to <code class=\"language-text\">start</code> and <code class=\"language-text\">stop</code> a Docker container</p>\n<ul>\n<li><code class=\"language-text\">docker start &lt;CONTAINER_NAME&gt;</code> to start a container</li>\n<li><code class=\"language-text\">docker stop &lt;CONTAINER_NAME&gt;</code> to stop a running container</li>\n</ul>\n</blockquote>\n<h3>PSQL Terminal</h3>\n<p>Use the following command to hop into the PSQL terminal session.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker exec -ti &lt;CONTAINER_NAME || postgres-9.6.14&gt; psql -h localhost -U postgres</code></pre></div>\n<h2>Configurations</h2>\n<h3>Postgres</h3>\n<p>To replace the default packaged H2 database with Postgres, initially, we have to create the databases and tables in Postgres. Find and execute the following PostgreSQL scripts to create and set up all necessary tables and indexes.</p>\n<blockquote>\n<p>You can use either any database tools like DBeaver (Jump to <a href=\"#dbeaver\">DBeaver</a>) or you can straightaway execute them using PSQL terminal (Jump to <a href=\"#psql\">PSQL</a>)</p>\n</blockquote>\n<ul>\n<li><code class=\"language-text\">&lt;IS&gt;/dbscripts/postgresql.sql</code></li>\n<li><code class=\"language-text\">&lt;IS&gt;/dbscripts/identity/postgresql.sql</code></li>\n<li><code class=\"language-text\">&lt;IS&gt;/dbscripts/identity/uma/postgresql.sql</code></li>\n<li><code class=\"language-text\">&lt;IS&gt;/dbscripts/identity/stored-procedures/postgre/postgresql.sql</code></li>\n<li><code class=\"language-text\">&lt;IS&gt;/dbscripts/consent/postgresql.sql</code></li>\n</ul>\n<p>Start the Postgres container (if not started before) using the following command</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker start postgres-9.6.14</code></pre></div>\n<h4>PSQL</h4>\n<p>Execute the following command to enter the PSQL terminal session and run the create query to create a database named <code class=\"language-text\">wso2postgres</code></p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker exec -ti postgres-9.6.14 psql -h localhost -U postgres</code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">create</span> <span class=\"token keyword\">database</span> wso2postgres<span class=\"token punctuation\">;</span></code></pre></div>\n<p>After successful creation, try to connect to the <code class=\"language-text\">wso2postgres</code> database using the following command</p>\n<div class=\"gatsby-highlight\" data-language=\"psql\"><pre class=\"language-psql\"><code class=\"language-psql\">\\c wso2postgres;</code></pre></div>\n<p>Next, quite the terminal session using <code class=\"language-text\">\\q</code> command and copy the <code class=\"language-text\">dbscripts</code> folder from the <code class=\"language-text\">&lt;IS_HOME&gt;</code> path to our <code class=\"language-text\">postgres-9.6.14</code> container volume to execute all related scripts using the Docker PSQL terminal.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">docker cp &lt;IS_HOME&gt;/dbscripts postgres-9.6.14:/</code></pre></div>\n<p>and run the following commands one by one to execute the scripts</p>\n<ul>\n<li>\n<pre>docker exec -ti postgres-9.6.14 psql -h localhost -U postgres -d wso2postgres -f /dbscripts/postgresql.sql</pre>\n</li>\n<li><code class=\"language-text\">docker exec -ti postgres-9.6.14 psql -h localhost -U postgres -d wso2postgres -f /dbscripts/identity/postgresql.sql</code></li>\n<li><code class=\"language-text\">docker exec -ti postgres-9.6.14 psql -h localhost -U postgres -d wso2postgres -f /dbscripts/identity/uma/postgresql.sql</code></li>\n<li><code class=\"language-text\">docker exec -ti postgres-9.6.14 psql -h localhost -U postgres -d wso2postgres -f /dbscripts/identity/stored-procedures/postgre/postgresql.sql</code></li>\n<li><code class=\"language-text\">docker exec -ti postgres-9.6.14 psql -h localhost -U postgres -d wso2postgres -f /dbscripts/consent/postgresql.sql</code></li>\n</ul>\n<p>After a successful connection, execute the above-mentioned SQL scripts to create related tables and indexes. But, before executing them, we have to copy the <code class=\"language-text\">dbscripts</code> folder to the related container volume to execute the script using PSQL terminal. Execute the following command to copy the <code class=\"language-text\">dbscripts</code> folder from the <code class=\"language-text\">&lt;IS_HOME&gt;</code> path to our <code class=\"language-text\">postgres-9.6.14</code> container volume.</p>\n<h4>DBeaver</h4>\n<blockquote>\n<p>Prerequisites: DBeaver installed in your environment. You can follow the <a href=\"https://dbeaver.io\">DBeaver</a> site.</p>\n</blockquote>\n<p>Open DBeaver and create a new database connection. Select <code class=\"language-text\">PostgreSQL</code> from the list and click <code class=\"language-text\">Next</code>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/select-database-73b1ea6935a3636ffae7824e88ee80db-07eac.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 108.5139318885449%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAWCAYAAADAQbwGAAAACXBIWXMAABYlAAAWJQFJUiTwAAADXklEQVQ4y7VUy44TRxT1L+U7WEbKfwSJdZSwYBGxQSQoyjYsEGIUkCBhQFkETcDYZobxjB/j7rY9Hne7n+73s9yHe8vTM0AUBIuUdFTtctWpe8+5t1rL/hF64y5G2glURcVsNsPpYiFnxmAwwNHRkcTh4SE0TcN8Pr/4nzGdzqBqM0zUGVqL01NMlAm06RTD4RCmaSLPcwghsNlsUFWCUF2gWW/A/+eFQJJVcPwcrfV6jdVqBXNlwrZtScgzH9we5rmSYIKyLFEUxQV5g4r30p6WQ4eTJEEYhvB9H0EQIKbfQRQhjEL6TlFUG+SlQBQnaAaT8rk8z+DROVV34DoOWoPRGIqqgokty4JNi0WaQsQxUBU4sTa4ce8lbj7oYOYDT58+wXfXv4eu65I4TXMiL1HXtbykdaycot3p4YyMyLIMCZFtSEMQMZIIAxu4+stzfPvzE6ge8OPuT/jqhys4Nk4kobqwEMaZ/ObUW6PRCN1uV97oui7xUISkk0HRijLHwVLg17/OcGd3ir5RY+5qeKMfIhMUWV5gRo4HJBcP1lUSttttWRKOY0tCUbEBNQQhLgE7FDCdFElRg4zEq5FxoWfj+gcR9no9dDodGIaBtechzkokoY0qXcuNkWMhXm01u/ZMx9e3HqPKU6mb5QYoxeY8wnNCJtvf36co+zAo9TBKoJ/NUSS+FHyiKFgst4QvJjbeasb2IjKOM4ri6DJC7gQmZOzt7WG5XCJLI9IlIi1rWYdxSmaRYRwRaoGUyoXT5AaIopicfs8UbqXxeCwxHA6w1C0S24DS/wax392m8ttdiD/+lN8bZw7x6C4tUoeUFdaGQmW2vDSFu8Qj3djhrcvcJcA/f99G/+Ch3Jg82EG6+wwUH8qVgvT5DpVWJUvMtU3KKDiPkAjZCNaB243RlI7tUNpBgoR0Mqg9Dbo0CgOsTAuG48KjNY/2mtwMtivlkCl/TCjLhkOUo8aXjP8k5AdA0tGtn4tPErK4/wvhl45/EW5nhwT3sfYDes4C+Zx9Lvht/YDQIvgevY++KRF41rmL26ftU2ge5xa/MlyHfND3HBwoHnbaIe6/DLF3vEboe9Q9uryUS+p9kmaN5wYyQia0LFsS9jUPjzoBfn8d4NXQQ8CE+iVho3Uj0ceE7wBTiXoEQ5pkAAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Select Database\"\n        title=\"\"\n        src=\"/static/select-database-73b1ea6935a3636ffae7824e88ee80db-fb8a0.png\"\n        srcset=\"/static/select-database-73b1ea6935a3636ffae7824e88ee80db-1a291.png 148w,\n/static/select-database-73b1ea6935a3636ffae7824e88ee80db-2bc4a.png 295w,\n/static/select-database-73b1ea6935a3636ffae7824e88ee80db-fb8a0.png 590w,\n/static/select-database-73b1ea6935a3636ffae7824e88ee80db-526de.png 885w,\n/static/select-database-73b1ea6935a3636ffae7824e88ee80db-fa2eb.png 1180w,\n/static/select-database-73b1ea6935a3636ffae7824e88ee80db-07eac.png 1292w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>Enter <code class=\"language-text\">wso2postgres</code> for the <code class=\"language-text\">Database</code> field and use <code class=\"language-text\">hydrogen</code> as <code class=\"language-text\">Password</code>.</p>\n<blockquote>\n<p>Please change and use related values for the <code class=\"language-text\">Host</code>, <code class=\"language-text\">Port</code>, <code class=\"language-text\">Database</code>, <code class=\"language-text\">User</code> and <code class=\"language-text\">Password</code> fields if those are different from mentioned default values.</p>\n<p>If you have not installed any PostgreSQL driver for DBeaver, it will prompt you to follow a couple of instructions to install necessary drivers to work with Postgres databases and connections</p>\n</blockquote>\n<p><img src=\"assets/replace-h2-postgres/postgres-connection-configurations.png\" alt=\"Postgres Connection Configurations\"></p>\n<p>Click on <code class=\"language-text\">Test Connection</code> to test the database connection and if success then click the <code class=\"language-text\">Finish</code> to finish the connection configuration process. The created connection will be listed under the <code class=\"language-text\">Database Navigator</code> panel (on the left-side navigation panel). Navigate to <code class=\"language-text\">File</code> -> <code class=\"language-text\">Open File ...</code> and select and open the above-listed PostgreSQL scripts in the DBeaver.</p>\n<p>Select the database connection and the Postgres schema if not selected by default and click <code class=\"language-text\">Execute SQL Script</code> to execute the script. Do this for all above-mentioned <a href=\"#postgres\">PostgreSQL scripts</a>.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-75ec9.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 48.1%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABX0lEQVQoz52SXXOaQBSG+f8/pxe9azrNZEzBBD9CTI0FxQhUQWFBBXeFpwsXmXbamE535tnzXux5z7s7a7jzOX4QMbu/YznUDDQjm8VwwGp03+F7Lv4qIIoifqw3mvWbGIHnEy6WhP4Lq1VIEAbkxZ5iXyLyI6JoKTsyrd/DKOMtyWLOnWliWhY3N894zwlN3fA/y2g3pXsnts3s6Yle7ztjc0J1rGgt66amaZp/xliPRqydB3bTKdHCoyh2SFn9Mbk93E7oyiXD2HHw+30GX28ZDqZMnSWFfoZ4U5CXOaLKOJwOr6ad8XtXPlQVPfOWq882Hz984+HaIXE9pJLIs0Sd1W8pXhO/ZVgejzz2LSbjMZY549GaEL5EnE6nvzZdSmmUScw+SUg3G3a6ilyQi1TrmO12S5ZlCCE60jRFSXk54fL6C+7VJ1z9ZWyN57pkuvGsFEojtYH6RTd1fdHwJzOT/Cwb82dLAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Execute Postgres Script\"\n        title=\"\"\n        src=\"/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-fb8a0.png\"\n        srcset=\"/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-1a291.png 148w,\n/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-2bc4a.png 295w,\n/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-fb8a0.png 590w,\n/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-526de.png 885w,\n/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-fa2eb.png 1180w,\n/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-08f6a.png 1770w,\n/static/execute-postgres-scripts-767c077aa62351e23da977cb81d0685e-75ec9.png 2000w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h3>WSO2 Identity Server</h3>\n<blockquote>\n<p>Below described steps and guides are based on fresh-pack installation. If you have any pre-stored data inside the H2 database, then you have to migrate them to the new data-source which is not covered in this topic.</p>\n</blockquote>\n<p>After setting up the databases, now we have to install the Postgres JDBC connector (driver) for our WSO2 Identity Server. Download the Postgres driver from <a href=\"https://jdbc.postgresql.org/download.html\">here</a>, copy and place the <code class=\"language-text\">jar</code> file inside the <code class=\"language-text\">&lt;IS&gt;/repository/components/lib</code> directory.</p>\n<p>Next, we have to configure our database connection settings in the Identity Server to connect to our Postgres source. Make changes to the following XML files to swap the connection from default H2 database to our Postgres database.</p>\n<ul>\n<li><a href=\"#master-datasource\"><code class=\"language-text\">&lt;IS&gt;/repository/conf/datasources/master-datasources.xml</code></a></li>\n<li><a href=\"#identity\"><code class=\"language-text\">&lt;IS&gt;/repository/conf/identity/identity.xml</code></a></li>\n<li><a href=\"#registry\"><code class=\"language-text\">&lt;IS&gt;/repository/conf/registry.xml</code></a></li>\n</ul>\n<blockquote>\n<p>Moreover, We will also be swapping the user store from the default LDAP server to the JDBC store</p>\n</blockquote>\n<ul>\n<li><a href=\"#user-management\"><code class=\"language-text\">&lt;IS&gt;/repository/conf/user-mgt.xml</code></a></li>\n</ul>\n<blockquote>\n<p>Replace and change the <code class=\"language-text\">host</code>, <code class=\"language-text\">port</code>, <code class=\"language-text\">username</code>, and <code class=\"language-text\">password</code> segments with respective values if different.</p>\n</blockquote>\n<h4>Master DataSource</h4>\n<p>Add the following datasource configuration below the default H2 configuration.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!-- master-datasources.xml --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>datasource</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>WSO2_CARBON_POSTGRES_DB<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>description</span><span class=\"token punctuation\">></span></span>The datasource used for registry and user manager<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>description</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>jndiConfig</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>name</span><span class=\"token punctuation\">></span></span>jdbc/WSO2CarbonPostgresDB<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>name</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>jndiConfig</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>definition</span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>RDBMS<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>configuration</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>url</span><span class=\"token punctuation\">></span></span>jdbc:postgresql://localhost:5432/wso2postgres<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>url</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>username</span><span class=\"token punctuation\">></span></span>postgres<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>username</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>password</span><span class=\"token punctuation\">></span></span>hydrogen<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>password</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>driverClassName</span><span class=\"token punctuation\">></span></span>org.postgresql.Driver<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>driverClassName</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>maxActive</span><span class=\"token punctuation\">></span></span>80<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>maxActive</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>maxWait</span><span class=\"token punctuation\">></span></span>60000<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>maxWait</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>minIdle</span><span class=\"token punctuation\">></span></span>5<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>minIdle</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>testOnBorrow</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>testOnBorrow</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>validationQuery</span><span class=\"token punctuation\">></span></span>SELECT 1; COMMIT<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>validationQuery</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>defaultAutoCommit</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>defaultAutoCommit</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>validationInterval</span><span class=\"token punctuation\">></span></span>30000<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>validationInterval</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>configuration</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>definition</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>datasource</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h4>Identity</h4>\n<p>Change the data-source in <code class=\"language-text\">repository/conf/identity/identity.xml</code> with the Postgres JNDI configuration name.</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!-- identity.xml --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>JDBCPersistenceManager</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>DataSource</span><span class=\"token punctuation\">></span></span>\n            <span class=\"token comment\">&lt;!-- Include a data source name (jndiConfigName) from the set of data\n                sources defined in master-datasources.xml --></span>\n            <span class=\"token comment\">&lt;!-- &lt;Name>jdbc/WSO2CarbonDB&lt;/Name> --></span>\n\n            <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Name</span><span class=\"token punctuation\">></span></span>jdbc/WSO2CarbonPostgresDB<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Name</span><span class=\"token punctuation\">></span></span>\n        <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>DataSource</span><span class=\"token punctuation\">></span></span>\n        ...</code></pre></div>\n<h4>Registry</h4>\n<p>The following changes are made to mount the registries with our newly created Postgres data-source.</p>\n<blockquote>\n<p>Don’t change the default <code class=\"language-text\">wso2registry</code> configurations unless if you want to. Add new registry mounting configurations below the default configurations.</p>\n</blockquote>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token comment\">&lt;!-- registry.xml --></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dbConfig</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>wso2registry<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span><span class=\"token punctuation\">></span></span>jdbc/WSO2CarbonDB<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dbConfig</span><span class=\"token punctuation\">></span></span>\n\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dbConfig</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>govregistry<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dataSource</span><span class=\"token punctuation\">></span></span>jdbc/WSO2CarbonPostgresDB<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dataSource</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dbConfig</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>remoteInstance</span> <span class=\"token attr-name\">url</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>https://localhost:9443/registry<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>id</span><span class=\"token punctuation\">></span></span>gov<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>id</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>cacheId</span><span class=\"token punctuation\">></span></span>postgres@jdbc:postgresql://localhost:5432/wso2postgres<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>cacheId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>dbConfig</span><span class=\"token punctuation\">></span></span>govregistry<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>dbConfig</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>readOnly</span><span class=\"token punctuation\">></span></span>false<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>readOnly</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>enableCache</span><span class=\"token punctuation\">></span></span>true<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>enableCache</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>registryRoot</span><span class=\"token punctuation\">></span></span>/<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>registryRoot</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>remoteInstance</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mount</span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/_system/governance<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">overwrite</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>instanceId</span><span class=\"token punctuation\">></span></span>gov<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>instanceId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>targetPath</span><span class=\"token punctuation\">></span></span>/_system/governance<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>targetPath</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mount</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>mount</span> <span class=\"token attr-name\">path</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>/_system/config<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">overwrite</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>true<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>instanceId</span><span class=\"token punctuation\">></span></span>gov<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>instanceId</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>targetPath</span><span class=\"token punctuation\">></span></span>/_system/config<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>targetPath</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>mount</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<h4>User Management</h4>\n<blockquote>\n<p>Below described steps are to change the default LDAP user-store to JDBC user-store. You can skip the following changes, if you want to keep the default LDAP user-store as out-of-the-box.</p>\n</blockquote>\n<p>Comment the existing <code class=\"language-text\">WSO2CarbonDB</code> data source property tag and place the <code class=\"language-text\">WSO2CarbonPostgresDB</code> property tag inside the <code class=\"language-text\">&lt;Configuration&gt;</code> element as described below</p>\n<div class=\"gatsby-highlight\" data-language=\"xml\"><pre class=\"language-xml\"><code class=\"language-xml\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Configuration</span><span class=\"token punctuation\">></span></span>\n    ...\n    <span class=\"token comment\">&lt;!-- &lt;Property name=\"dataSource\">jdbc/WSO2CarbonDB&lt;/Property> --></span>\n\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>Property</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>dataSource<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>jdbc/WSO2CarbonPostgresDB<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Property</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>Configuration</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Further, comment the LDAP user store manager configurations and uncomment the JDBC user store manager. This will route our default LDAP user store with JDBC user store.</p>\n<h2>Run &#x26; Test</h2>\n<p>Start the WSO2 Identity Server by navigating to the <code class=\"language-text\">&lt;IS&gt;/bin</code> folder and execute the following command based on your environment</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"># linux env\n./wso2server.sh\n\n# windows env\n./wso2server.bat</code></pre></div>\n<p>The server will start and configure the platform to work with new configurations. After successful startup, bring up your favourite browser and navigate to <code class=\"language-text\">https://localhost:9443/carbon</code> and enter <code class=\"language-text\">admin</code> as both username and password.</p>\n<hr class=\"three--dots\"/>","frontmatter":{"title":"Replace H2 with Postgres","intro":"WSO2 Identity Server (5.7): Replace Default H2 DB with Postgres DB","tags":["wso2","wso2-identity-server","h2","postgres"],"author":"Athiththan"}}},"pageContext":{"slug":"/Replace-H2-with-Postgres/","node_id":"eac2d4d3-f6b0-5791-beef-f546659f719f","nodePath":"/Replace-H2-with-Postgres/","nodeType":"sheet","title":"Replace H2 with Postgres","category":"WSO2","weight":-1,"updated":"2019-07-21T00:00:00.000Z","author":"Athiththan","short":"Guide to replace H2 with Postgres DB","tags":["wso2","wso2-identity-server","h2","postgres"]}}