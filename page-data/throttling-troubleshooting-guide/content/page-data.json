{"componentChunkName":"component---src-templates-reveal-post-js","path":"/throttling-troubleshooting-guide/content/","result":{"data":{"site":{"siteMetadata":{"title":"StackCheats","author":"Athiththan Kathirgamasegaran"}},"markdownRemark":{"frontmatter":{"title":"Preview Deck | Troubleshoot Guide","date":"May 18, 2021","intro":"A Troubleshooting guide for Throttling","tags":["wso2","reveal","sample"],"seo":"A sample reveal JS content"},"html":"<section>\n<h1>ðŸ‘‹ Preview Deck</h1>\n</section>\n<section>\n<h2>Troubleshoot Throttling</h2>\n<p>This reveal deck contains the fundamental steps and instructions to troubleshoot few well-known issues in API Throttling of WSO2 API Manager.</p>\n<blockquote>\n<p>This deck is drafted based on API Manager v3.2.0, however, this can referenced for v3.1.0, and v3.0.0 versions</p>\n</blockquote>\n<blockquote>\n<p><em>Move across the deck using either arrow key on the keyboard, of by clicking the arrow icons in the bottom-right corner</em></p>\n</blockquote>\n<p>Let's get started!!!</p>\n<aside class=\"notes\">\n<blockquote>\n<p>Use the arrow keys (<code class=\"language-text\">up</code>,<code class=\"language-text\">right</code>, <code class=\"language-text\">down</code>, and <code class=\"language-text\">left</code>) on the keyboard to navigate through the deck\n<br/><br/>\nPress <code class=\"language-text\">o</code> to show an overview of the deck\n<br/><br/>\nPress <code class=\"language-text\">f</code> for full-screen mode</p>\n</blockquote>\n</aside>\n</section>\n<section>\n<section>\n<p>Are you having any issues while publishing a (custom) policy from the <code class=\"language-text\">Admin</code> portal?</p>\n<p>If <strong>yes</strong>, go through the <code class=\"language-text\">below</code>-given steps to verify the configurations in your environment.\nIf <strong>no</strong>, move to the <code class=\"language-text\">right</code>.</p>\n</section>\n<section>\n<p>A probable cause for this behavior can be a misconfiguration of the <code class=\"language-text\">Service URL</code> of the <code class=\"language-text\">Policy Deployer</code>. Open the <code class=\"language-text\">&lt;publisher&gt;/repository/conf/deployment.toml</code> and validate the following</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token punctuation\">[</span><span class=\"token table class-name\">apim.throttling</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">service_url</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"https://tm-lb-hostname:9443/services/\"</span></code></pre></div>\n<blockquote>\n<p>The <code class=\"language-text\">service_url</code> must point to the Traffic Manager's <code class=\"language-text\">services</code> endpoint. This is used to publish and deploy the execution policies in Traffic Manager. If the endpoint is not reachable or misconfigured, there will be errors logged in the Publisher.</p>\n</blockquote>\n</section>\n<section>\n<p>Further, if you are using different user credentials (<code class=\"language-text\">username</code> and <code class=\"language-text\">password</code>) for each node, please perform the following configurations in the Publisher's <code class=\"language-text\">deployment.toml</code> to authenticate with the Traffic Manager without any failures.</p>\n<div class=\"gatsby-highlight\" data-language=\"toml\"><pre class=\"language-toml\"><code class=\"language-toml\"><span class=\"token punctuation\">[</span><span class=\"token table class-name\">apim.throttling.policy_deploy</span><span class=\"token punctuation\">]</span>\n<span class=\"token key property\">username</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"traffic-manager-admin-username\"</span>\n<span class=\"token key property\">password</span> <span class=\"token punctuation\">=</span> <span class=\"token string\">\"traffic-manager-admin-password\"</span></code></pre></div>\n</section>\n</section>\n<section>\n<section>\n<blockquote>\n<p>We assume that you don't have any issues with creating or publishing (custom) policies from the Admin portal. But, experiencing inconsistent behavior during the runtime.</p>\n</blockquote>\n<p>If you are experiencing errors in the Gateway node during runtime, scroll <code class=\"language-text\">down</code>. If not, move to the <code class=\"language-text\">right</code>.</p>\n<aside class=\"notes\">\n<p>Advanced Throttling enables an async communication between Gateway and Traffic Manager. During runtime, the Gateway collects and sends events to the Traffic Manager to process decisions.</p>\n<blockquote>\n<p>If the API resource is unsecured, a default <code class=\"language-text\">Unauthenticated</code> subscription policy will be used to evaluate the subscription level throttling nevertheless the assigned.</p>\n</blockquote>\n</aside>\n</section>\n<section>\n<p>Are you seeing any of the following error-traces in the Gateway node?</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token constant\">ERROR</span> <span class=\"token operator\">-</span> DataEndpointConnectionWorker Error <span class=\"token keyword\">while</span> trying to connect to the endpoint<span class=\"token punctuation\">.</span> Cannot borrow client <span class=\"token keyword\">for</span> ssl<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>traffic<span class=\"token operator\">-</span>manager<span class=\"token operator\">-</span>host<span class=\"token operator\">:</span><span class=\"token number\">9711</span>\norg<span class=\"token punctuation\">.</span>wso2<span class=\"token punctuation\">.</span>carbon<span class=\"token punctuation\">.</span>databridge<span class=\"token punctuation\">.</span>agent<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span>DataEndpointAuthenticationException<span class=\"token operator\">:</span> Cannot borrow client <span class=\"token keyword\">for</span> ssl<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>traffic<span class=\"token operator\">-</span>manager<span class=\"token operator\">-</span>host<span class=\"token operator\">:</span><span class=\"token number\">9711</span>\n    <span class=\"token operator\">...</span>\nCaused by<span class=\"token operator\">:</span> org<span class=\"token punctuation\">.</span>wso2<span class=\"token punctuation\">.</span>carbon<span class=\"token punctuation\">.</span>databridge<span class=\"token punctuation\">.</span>agent<span class=\"token punctuation\">.</span>exception<span class=\"token punctuation\">.</span>DataEndpointException<span class=\"token operator\">:</span> Error <span class=\"token keyword\">while</span> opening socket to traffic<span class=\"token operator\">-</span>manager<span class=\"token operator\">-</span>host<span class=\"token operator\">:</span><span class=\"token number\">9711.</span> Connection <span class=\"token function\">refused</span> <span class=\"token punctuation\">(</span>Connection refused<span class=\"token punctuation\">)</span>\n    <span class=\"token operator\">...</span>\nCaused by<span class=\"token operator\">:</span> java<span class=\"token punctuation\">.</span>net<span class=\"token punctuation\">.</span>ConnectException<span class=\"token operator\">:</span> Connection <span class=\"token function\">refused</span> <span class=\"token punctuation\">(</span>Connection refused<span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>Yes</strong>? proceed <code class=\"language-text\">down</code>.</p>\n</section>\n<section>\n<p>The mentioned errors are logged due to connectivity issues between Gateway and Traffic Manager. Gateway establishes a Binary transport communication link with Traffic Manager to publish throttle data events.</p>\n<p>Check whether all required ports related to Binary communication (<code class=\"language-text\">9711</code> and <code class=\"language-text\">9611</code>) are opened and not blocked by any firewall. You can use the following <code class=\"language-text\">telnet</code> from Gateway instance to check the connectivity between Traffic Manager.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\">telnet traffic-manager-host <span class=\"token number\">9611</span></code></pre></div>\n</section>\n</section>\n<section>\n<h2>Happy Stacking!!! ðŸ‘ŒðŸ‘ŒðŸ‘Œ</h2>\n</section>"}},"pageContext":{"slug":"/throttling-troubleshooting-guide/content/"}},"staticQueryHashes":["2632472463"]}